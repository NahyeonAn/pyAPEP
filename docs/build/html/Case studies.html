<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Case studies &mdash; pyAPEP 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="canonical" href="https://nahyeonan.github.io/pyAPEP/Case studies.html" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FAQs" href="FAQs.html" />
    <link rel="prev" title="Real PSA simulation module (pyAPEP.simsep)" href="simsep.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #BED2E0" >

          
          
          <a href="index.html">
            
              <img src="_static/pyAPEP.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyAPEP.html">pyAPEP</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Case studies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ideal-psa-simulation-for-green-hydrogen-production">1. Ideal PSA simulation for green hydrogen production</a></li>
<li class="toctree-l2"><a class="reference internal" href="#real-psa-simulation-for-biogas-upgrading">2. Real PSA simulation for biogas upgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="#development-of-machine-learning-based-model-for-psa-process">3. Development of machine learning-based model for PSA process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FAQs.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Citation.html">Citation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #BED2E0" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyAPEP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Case studies</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Case studies.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="case-studies">
<h1>Case studies<a class="headerlink" href="#case-studies" title="Permalink to this heading"></a></h1>
<p>Here are some examples.</p>
<section id="ideal-psa-simulation-for-green-hydrogen-production">
<h2>1. Ideal PSA simulation for green hydrogen production<a class="headerlink" href="#ideal-psa-simulation-for-green-hydrogen-production" title="Permalink to this heading"></a></h2>
<p>In this example, <a class="reference internal" href="simide.html#module-pyAPEP.simide" title="pyAPEP.simide"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyAPEP.simide</span></code></a> is used to simulate ideal PSA process for the separation of H<sub>2</sub>/N<sub>2</sub> from the green ammonia.</p>
<p><strong>Background</strong></p>
<p>Because green ammonia is currently the favored transportation medium for carbon-free hydrogen, H<sub>2</sub> separation and purification after the decomposition of NH<sub>3</sub> is important to maximize the use of H<sub>2</sub>. Among all gas separation processes, the PSA is the most suitable process with the highest technological readiness. Therefore, this example compares adsorbents based on the performance of the ideal PSA for producing H<sub>2</sub> from the N<sub>2</sub>/H<sub>2</sub> gas mixture, and it determines the best adsorbent with the highest hydrogen recovery.</p>
<figure class="align-center" id="id1" style="width: 70%">
<img alt="GreenNH3 process" src="_images/example1.png" />
<figcaption>
<p><span class="caption-text">Figure. Schematic of pressure swing adsorption process used for H<sub>2</sub> purification.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p><strong>Process description</strong></p>
<p>The target green ammonia decomposition process consists of an NH<sub>3</sub> decomposition reactor, NH<sub>3</sub> separator, and PSA process for H<sub>2</sub> purification. In the NH<sub>3</sub> decomposition reactor, the H<sub>2</sub> was produced by decomposing NH<sub>3</sub> into a mixture of N<sub>2</sub> and H<sub>2</sub>. The NH<sub>3</sub> separator removed residual NH<sub>3</sub> from the feed stream. Therefore, the gas entering the target PSA process was assumed to be 25 mol% N<sub>2</sub> and 75 mol% H<sub>2</sub>.</p>
<p><strong>Goal</strong></p>
<p>The goal of this example is the find best adsorbent among three adsorbents by comparing PSA perfomances. Adsorbent candidates are Zeolite 13X, 5A and activated carbon. All adsorbents and its pressure-uptake data could be found in literatures. This example contains isotherm fitting with given data(.csv), isotherm validation, development of mixture isotherm for each adsorbent, and ideal PSA simulation.</p>
<p><strong>Before we start, import pyAPEP package and other python packages for data treatment and visualization. Also, users need to download the adsorption data files for three adsobents</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pyAPEP package import</span>
<span class="kn">import</span> <span class="nn">pyAPEP.isofit</span> <span class="k">as</span> <span class="nn">isofit</span>
<span class="kn">import</span> <span class="nn">pyAPEP.simide</span> <span class="k">as</span> <span class="nn">simide</span>

<span class="c1"># Data treatment package import</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Data visualization package import</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<p id="isotherm-definition"><strong>Then, define pure isotherm function for hydrogen and nitrogen using pressure-uptake data samples.</strong> Before developing isotherm, users need to define or import datasets. If the isotherm parameters already exist, users can use those parameters by defining isotherm function manually.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data import</span>
<span class="c1"># adsorbent 1</span>
<span class="n">Data_zeo13</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Casestudy1_Zeolite13X.csv&#39;</span><span class="p">)</span>
<span class="c1"># adsorbent 2</span>
<span class="n">Data_ac</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Casestudy1_Activated_carbon.csv&#39;</span><span class="p">)</span>
<span class="c1"># adsorbent 3</span>
<span class="n">Data_zeo5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Casestudy1_Zeolite5A.csv&#39;</span><span class="p">)</span>

<span class="n">Data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Data_zeo13</span><span class="p">,</span> <span class="n">Data_ac</span><span class="p">,</span> <span class="n">Data_zeo5</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find best isotherm function, Ideal PSA simulation</span>
<span class="n">Adsorbent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Zeolite13X&#39;</span><span class="p">,</span><span class="s1">&#39;Activated_carbon&#39;</span><span class="p">,</span> <span class="s1">&#39;Zeolite5A&#39;</span><span class="p">]</span>
<span class="n">iso_pure</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">err_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
   <span class="n">ads</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

   <span class="n">P_N2</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="s1">&#39;Pressure_N2 (bar)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
   <span class="n">q_N2</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="s1">&#39;Uptake_N2 (mol/kg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

   <span class="n">P_H2</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="s1">&#39;Pressure_H2 (bar)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
   <span class="n">q_H2</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="s1">&#39;Uptake_H2 (mol/kg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

   <span class="n">N2_iso</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">N2_err</span> <span class="o">=</span> <span class="n">isofit</span><span class="o">.</span><span class="n">best_isomodel</span><span class="p">(</span><span class="n">P_N2</span><span class="p">,</span> <span class="n">q_N2</span><span class="p">)</span>
   <span class="n">H2_iso</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">H2_err</span> <span class="o">=</span> <span class="n">isofit</span><span class="o">.</span><span class="n">best_isomodel</span><span class="p">(</span><span class="n">P_H2</span><span class="p">,</span> <span class="n">q_H2</span><span class="p">)</span>

   <span class="n">iso_pure</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">N2_iso</span><span class="p">,</span> <span class="n">H2_iso</span><span class="p">])</span>
   <span class="n">err_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">N2_err</span><span class="p">,</span> <span class="n">H2_err</span><span class="p">])</span>

   <span class="c1"># visualization</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">P_N2</span><span class="p">,</span> <span class="n">q_N2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">P_H2</span><span class="p">,</span> <span class="n">q_H2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

   <span class="n">P_max</span><span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">P_N2</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">P_H2</span><span class="p">))</span>
   <span class="n">P_dom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">P_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P_dom</span><span class="p">,</span> <span class="n">N2_iso</span><span class="p">(</span><span class="n">P_dom</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span> <span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P_dom</span><span class="p">,</span> <span class="n">H2_iso</span><span class="p">(</span><span class="n">P_dom</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span> <span class="p">)</span>

   <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pressure (bar)&#39;</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Uptake (mol/kg)&#39;</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Adsorbent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;N$_2$ data&#39;</span><span class="p">,</span> <span class="s1">&#39;H$_2$ data&#39;</span><span class="p">,</span>
             <span class="s1">&#39;N$_2$ isotherm&#39;</span><span class="p">,</span><span class="s1">&#39;H$_2$ isotherm&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Check developed pure isotherm functions by comparing with raw data.</p>
<p><a class="reference internal" href="_images/Zeolite13X.png"><img alt="pic1" src="_images/Zeolite13X.png" style="width: 49%;" /></a> <a class="reference internal" href="_images/ActivatedC.png"><img alt="pic2" src="_images/ActivatedC.png" style="width: 49%;" /></a></p>
<figure class="align-center" style="width: 49%">
<img alt="Zeolite5A" src="_images/Zeolite5A.png" />
</figure>
<p><strong>We need mixture isotherm functions to simulate PSA process. Here we define the hydrogen/nitrogen mixture isotherm functions with</strong> <code class="xref py py-mod docutils literal notranslate"><span class="pre">isofit.IAST</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iso_mix_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
   <span class="n">N2_iso_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">P</span><span class="p">,</span><span class="n">T</span><span class="p">:</span> <span class="n">iso_pure</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="n">P</span><span class="p">)</span>
   <span class="n">H2_iso_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">P</span><span class="p">,</span><span class="n">T</span><span class="p">:</span> <span class="n">iso_pure</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">](</span><span class="n">P</span><span class="p">)</span>

   <span class="n">iso_mix</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">P</span><span class="p">,</span><span class="n">T</span> <span class="p">:</span> <span class="n">isofit</span><span class="o">.</span><span class="n">IAST</span><span class="p">([</span><span class="n">N2_iso_</span><span class="p">,</span> <span class="n">H2_iso_</span><span class="p">],</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

   <span class="n">iso_mix_app</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">iso_mix</span><span class="p">)</span>
   <span class="n">iso_mix_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iso_mix_app</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Then we need to define and run ideal PSA process.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
   <span class="n">iso_mix</span> <span class="o">=</span> <span class="n">iso_mix_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

   <span class="n">CI1</span> <span class="o">=</span> <span class="n">simide</span><span class="o">.</span><span class="n">IdealColumn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">iso_mix</span> <span class="p">)</span>

   <span class="c1"># Feed condition setting</span>
   <span class="n">P_feed</span> <span class="o">=</span> <span class="mi">8</span>      <span class="c1"># Feed presure (bar)</span>
   <span class="n">T_feed</span> <span class="o">=</span> <span class="mf">293.15</span>    <span class="c1"># Feed temperature (K)</span>
   <span class="n">y_feed</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">]</span> <span class="c1"># Feed mole fraction (mol/mol)</span>
   <span class="n">CI1</span><span class="o">.</span><span class="n">feedcond</span><span class="p">(</span><span class="n">P_feed</span><span class="p">,</span> <span class="n">T_feed</span><span class="p">,</span> <span class="n">y_feed</span><span class="p">)</span>

   <span class="c1"># Operating condition setting</span>
   <span class="n">P_high</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1"># High pressure (bar)</span>
   <span class="n">P_low</span>  <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Low pressure (bar)</span>
   <span class="n">CI1</span><span class="o">.</span><span class="n">opercond</span><span class="p">(</span><span class="n">P_high</span><span class="p">,</span> <span class="n">P_low</span><span class="p">)</span>

   <span class="c1"># Simulation run</span>
   <span class="n">x_tail</span> <span class="o">=</span> <span class="n">CI1</span><span class="o">.</span><span class="n">runideal</span><span class="p">()</span>
   <span class="n">R</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span> <span class="p">(</span><span class="n">y_feed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x_tail</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="n">x_tail</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y_feed</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>       <span class="c1"># Output: [x_H2, x_N2]</span>
   <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Now, we can calculate hydrogen recovery for this system.</strong> The results shows below. Finally, we found the best performance adsorbent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Results plot</span>
<span class="n">Adsorbent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Zeolite13X&#39;</span><span class="p">,</span><span class="s1">&#39;Activated_carbon&#39;</span><span class="p">,</span> <span class="s1">&#39;Zeolite5A&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">Adsorbent</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">80</span><span class="p">,</span> <span class="mi">95</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;H$_2$ recovery (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-center" style="width: 49%">
<img alt="H2_results" src="_images/H2_results.png" />
</figure>
<p><strong>Additionally, sensitivity analysis was carried out.</strong> Below figure shows the results of sensitivity analysis for each variable using the developed PSA process model.</p>
<figure class="align-center" style="width: 80%">
<img alt="sa1" src="_images/example1_sa1.png" />
</figure>
<p>The left, center, and right columns show the results for zeolite 13X, activated carbon, and zeolite 5A. The results show the difference in H<sub>2</sub> recovery for adsorption (<span class="math notranslate nohighlight">\(P_{f}\)</span>), regeneration pressure (<span class="math notranslate nohighlight">\(P_{t}\)</span>), temperature (<span class="math notranslate nohighlight">\(T_{f}\)</span>), and H<sub>2</sub> composition (<span class="math notranslate nohighlight">\(y_{H_2}\)</span>) of the feed flow, and H<sub>2</sub> and N<sub>2</sub> uptake (<span class="math notranslate nohighlight">\(q\)</span>) were adjusted from -30 to +30%, respectively, while all other parameters were fixed. All three adsorbents reacted sensitively to H<sub>2</sub> recovery according to the feed temperature, and in particular, in the case of zeolite 5A, when the temperature increased by 30 %, the H<sub>2</sub> recovery rapidly decreased to approximately 50 %.</p>
<p>Below figure shows the H<sub>2</sub> recovery for the  five variables, except for the feed temperature, which further helped analyze the impact of other variables more clearly.</p>
<figure class="align-center" style="width: 80%">
<img alt="sa1" src="_images/example1_sa2.png" />
</figure>
<p>Although the degree of sensitivity for each adsorbent is different, the recovery increases with <span class="math notranslate nohighlight">\(P_{f}\)</span> and <span class="math notranslate nohighlight">\(q_{N_2}\)</span>, and it tends to decrease as <span class="math notranslate nohighlight">\(P_{t}\)</span>, <span class="math notranslate nohighlight">\(y_{H_2}\)</span> and <span class="math notranslate nohighlight">\(q_{H_2}\)</span> increase. Among all three adsorbents, <span class="math notranslate nohighlight">\(T_{f}\)</span> had the most significant impact H<sub>2</sub> recovery, followed by <span class="math notranslate nohighlight">\(q_{H_2}\)</span>.</p>
</section>
<hr class="docutils" />
<section id="real-psa-simulation-for-biogas-upgrading">
<h2>2. Real PSA simulation for biogas upgrading<a class="headerlink" href="#real-psa-simulation-for-biogas-upgrading" title="Permalink to this heading"></a></h2>
<p>In this example, <a class="reference internal" href="simsep.html#module-pyAPEP.simsep" title="pyAPEP.simsep"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyAPEP.simsep</span></code></a> is used to simulate real PSA process for the separation of CO<sub>2</sub>/CH<sub>4</sub> in biogas upgrading process.</p>
<p><strong>Background</strong></p>
<p>Biogas is a gas mixture that is produced when biomass such as livestock manure, agricultural waste, and sewage sludge is anaerobic digested. The composition of the biogas is generally composed of 50-70% of methane and 30-45% of carbon dioxide, and the other compositions such as H<sub>2</sub> S, N<sub>2</sub> , O<sub>2</sub>, and NH<sub>3</sub> are present in a small amount of less than 4%. Methane has 21 times higher global warming potential thdan carbon dioxie, so energy recovery from biogas leads to environmental benefits as well as economic benefits, so it has recently received a lot of attention. Among the energy recovery methods, bio-mathane production through biogas upgrading is in the spotlight because the bio-mathane can be used for fuel, heating, and electricity production.
<strong>Therefore, in this example, the PSA process, which is a commonly used process for biogas upgrading, is simulated using the pyAPEP.simsep module.</strong></p>
<figure class="align-center" id="id2" style="width: 70%">
<img alt="ex2" src="_images/Example2.png" />
<figcaption>
<p><span class="caption-text">Figure. Schematic of bio-mathane production process.</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p><strong>Process description</strong></p>
<p>Biogas produced through anaerobic digester is a gas that has a composition ratio of 67 and 33 mol% of CH<sub>4</sub> and CO<sub>2</sub> through a desulfurization pretreatment process. A two-component system real PSA simulation is performed based on process conditions to purify the biogas. The PSA process for biogas upgrading is adsorbed at 9 bar and desorbed at 1 bar, and the temperature and pressure of feed flow into 323 K. Here, we evaluate the commercial adsorbent, zeolite 13X for the biogas upgading.</p>
<p><strong>Goal</strong></p>
<p>The goal of this example is the simulation of biogas upgrading process with commercial adsorbent. Zeolite 13X and its pressure-uptake data could be found in the literature. This example contains isotherm fitting with given data(.csv), development of mixutre isotherm function and real PSA simulation.</p>
<p><strong>Before we start, import pyAPEP packages. Also, users need to download adsorption data file (Example2_Zeolite13X.csv)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pyAPEP package import</span>
<span class="kn">import</span> <span class="nn">pyadserver.isofit</span> <span class="k">as</span> <span class="nn">isofit</span>
<span class="kn">import</span> <span class="nn">pyadserver.simsep</span> <span class="k">as</span> <span class="nn">simsep</span>

<span class="c1"># Data treatment package import</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Data visualization package import</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<p><strong>First, from the adsorption data samples, we need to find pure isotherm function for methane and carbon dioxide.</strong> Before developing isotherm, users need to define or import datasets. If the isotherm parameters already exist, users can use those parameters by defining isotherm function manually. Also, in this example, the single isotherm functions are used to simplify the process model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data import</span>
<span class="n">Data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Example2_Zeolite13X.csv&#39;</span><span class="p">)</span>

<span class="c1"># Pure isotherm definition</span>
<span class="n">P_CO2</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Pressure_CO2 (bar)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">q_CO2</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Uptake_CO2 (mol/kg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

<span class="n">P_CH4</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Pressure_CH4 (bar)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">q_CH4</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Uptake_CH4 (mol/kg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

<span class="n">CO2_iso</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">isofit</span><span class="o">.</span><span class="n">best_isomodel</span><span class="p">(</span><span class="n">P_CO2</span><span class="p">,</span> <span class="n">q_CO2</span><span class="p">)</span>
<span class="n">CH4_iso</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">isofit</span><span class="o">.</span><span class="n">best_isomodel</span><span class="p">(</span><span class="n">P_CH4</span><span class="p">,</span> <span class="n">q_CH4</span><span class="p">)</span>
<span class="n">CO2_iso_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">P</span><span class="p">,</span><span class="n">T</span><span class="p">:</span> <span class="n">CO2_iso</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">CH4_iso_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">P</span><span class="p">,</span><span class="n">T</span><span class="p">:</span> <span class="n">CH4_iso</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">MixIso</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
   <span class="n">q1</span> <span class="o">=</span> <span class="n">CO2_iso</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">q2</span> <span class="o">=</span> <span class="n">CH4_iso</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
   <span class="k">return</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span>
</pre></div>
</div>
<p><strong>Next, we define and run an actual PSA process.</strong> A majority of the process parameters were the same as those in ref. In this example, Skarstrom cycle, which is the operation method for PSA process, is simulated in four stages of adsorption-blowdown-purge-pressurization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Column design</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">1.35</span>
<span class="n">A_cros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.15</span><span class="o">**</span><span class="mi">2</span>
<span class="n">CR1</span> <span class="o">=</span> <span class="n">simsep</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">A_cros</span><span class="p">,</span> <span class="n">n_component</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">N_node</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>

<span class="c1">### Sorbent prop</span>
<span class="n">voidfrac</span> <span class="o">=</span> <span class="mf">0.37</span>                  <span class="c1"># (m^3/m^3)</span>
<span class="n">D_particle</span> <span class="o">=</span> <span class="mf">12e-4</span>               <span class="c1"># (m)</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">1324</span>                       <span class="c1"># (kg/m^3)</span>
<span class="n">CR1</span><span class="o">.</span><span class="n">adsorbent_info</span><span class="p">(</span><span class="n">MixIso</span><span class="p">,</span> <span class="n">voidfrac</span><span class="p">,</span> <span class="n">D_particle</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>

<span class="c1">### Gas prop</span>
<span class="n">Mmol</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.044</span><span class="p">,</span> <span class="mf">0.016</span><span class="p">]</span>            <span class="c1"># (kg/mol)</span>
<span class="n">mu_visco</span><span class="o">=</span> <span class="p">[</span><span class="mf">16.13E-6</span><span class="p">,</span> <span class="mf">11.86E-6</span><span class="p">]</span>   <span class="c1"># (Pa s)</span>
<span class="n">CR1</span><span class="o">.</span><span class="n">gas_prop_info</span><span class="p">(</span><span class="n">Mmol</span><span class="p">,</span> <span class="n">mu_visco</span><span class="p">)</span>

<span class="c1">### Transfer prop</span>
<span class="n">k_MTC</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">1E-2</span><span class="p">,</span> <span class="mf">1E-2</span><span class="p">]</span>            <span class="c1"># (m/s)</span>
<span class="n">a_surf</span> <span class="o">=</span> <span class="mi">1</span>                       <span class="p">(</span><span class="n">m2</span><span class="o">/</span><span class="n">m3</span><span class="p">)</span>
<span class="n">D_disp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1E-2</span><span class="p">,</span> <span class="mf">1E-2</span><span class="p">]</span>            <span class="c1"># (m^2/sec)</span>
<span class="n">CR1</span><span class="o">.</span><span class="n">mass_trans_info</span><span class="p">(</span><span class="n">k_MTC</span><span class="p">,</span> <span class="n">a_surf</span><span class="p">,</span> <span class="n">D_disp</span><span class="p">)</span>
<span class="n">dH_ads</span> <span class="o">=</span> <span class="p">[</span><span class="mf">31.164e3</span><span class="p">,</span><span class="mf">20.856e3</span><span class="p">]</span>     <span class="c1"># (J/mol)</span>
<span class="n">Cp_s</span> <span class="o">=</span> <span class="mi">900</span>
<span class="n">Cp_g</span> <span class="o">=</span> <span class="p">[</span><span class="mf">38.236</span><span class="p">,</span> <span class="mf">35.8</span><span class="p">]</span>            <span class="c1"># (J/mol/K)</span>
<span class="n">h_heat</span> <span class="o">=</span> <span class="mi">100</span>                     <span class="c1"># (J/m2/K/s)</span>
<span class="n">CR1</span><span class="o">.</span><span class="n">thermal_info</span><span class="p">(</span><span class="n">dH_ads</span><span class="p">,</span> <span class="n">Cp_s</span><span class="p">,</span> <span class="n">Cp_g</span><span class="p">,</span> <span class="n">h_heat</span><span class="p">)</span>
</pre></div>
</div>
<p>The operating and initial conditions are required to solve the differential equations. An appropriate value must be set for better convergence of the model. <strong>Each step of the Skarstrom cycle was implemented by adjusting the boundary and initial conditions. The parameter setting and simulation were repeated sequentially.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### Adsorption step ###</span>
<span class="c1">### Operating conditions</span>
<span class="n">P_inlet</span> <span class="o">=</span> <span class="mf">9.5</span>
<span class="n">P_outlet</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">T_feed</span> <span class="o">=</span> <span class="mi">323</span>
<span class="n">y_feed</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">0.67</span><span class="p">]</span>

<span class="n">Cv_inlet</span> <span class="o">=</span> <span class="mf">0.2E-1</span>             <span class="c1"># inlet valve constant (m/sec/bar)</span>
<span class="n">Cv_outlet</span><span class="o">=</span> <span class="mf">2.0E-1</span>           <span class="c1"># outlet valve constant (m/sec/bar)</span>

<span class="n">Q_feed</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">A_cros</span>  <span class="c1"># volumetric flowrate (m^3/sec)</span>

<span class="n">CR1</span><span class="o">.</span><span class="n">boundaryC_info</span><span class="p">(</span><span class="n">P_outlet</span><span class="p">,</span> <span class="n">P_inlet</span><span class="p">,</span> <span class="n">T_feed</span><span class="p">,</span> <span class="n">y_feed</span><span class="p">,</span>
                  <span class="n">Cv_inlet</span><span class="p">,</span> <span class="n">Cv_outlet</span><span class="p">,</span>
                  <span class="n">Q_inlet</span> <span class="o">=</span> <span class="n">Q_feed</span><span class="p">,</span>
                  <span class="n">assigned_v_option</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">foward_flow_direction</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1">### Initial conditions</span>
<span class="n">P_init</span> <span class="o">=</span> <span class="mf">9.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>    <span class="c1"># (bar)</span>
<span class="n">y_init</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="mf">0.999</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span> <span class="c1"># (mol/mol)</span>
<span class="n">T_init</span> <span class="o">=</span> <span class="n">T_feed</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">q_init</span> <span class="o">=</span> <span class="n">MixIso</span><span class="p">(</span><span class="n">P_init</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_init</span><span class="p">),</span> <span class="n">T_init</span><span class="p">)</span>

<span class="n">CR1</span><span class="o">.</span><span class="n">initialC_info</span><span class="p">(</span><span class="n">P_init</span><span class="p">,</span> <span class="n">T_init</span><span class="p">,</span> <span class="n">T_init</span><span class="p">,</span> <span class="n">y_init</span><span class="p">,</span> <span class="n">q_init</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">CR1</span><span class="p">)</span>
</pre></div>
</div>
<p>This example considers the mass, momentum, and energy balance equations, therefore <strong>run_mamoen function is used to run the simulation.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulation run</span>
<span class="n">y_res</span><span class="p">,</span> <span class="n">z_res</span><span class="p">,</span> <span class="n">t_res</span> <span class="o">=</span> <span class="n">CR1</span><span class="o">.</span><span class="n">run_mamoen</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span><span class="n">n_sec</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
                                 <span class="n">CPUtime_print</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, the adsorption step was simulated. <strong>The final results of this stage become the initial condition of the next step; the purge step and the boundary condition should be modified accordingly.</strong> After the simulation of the purge step, the blowdown step was implemented using the modified boundary condition and the final results of the previous step as an initial condition.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### Blowdown step ###</span>
<span class="n">CR1</span><span class="o">.</span><span class="n">next_init</span><span class="p">()</span>
<span class="n">CR1</span><span class="o">.</span><span class="n">change_init_node</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="c1">### Operating conditions</span>
<span class="n">P_inlet</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">P_outlet</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">T_feed</span> <span class="o">=</span> <span class="mi">323</span>
<span class="n">y_feed</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.999</span><span class="p">]</span>

<span class="n">Cv_inlet</span> <span class="o">=</span> <span class="mf">0E-1</span>             <span class="c1"># inlet valve constant (m/sec/bar)</span>
<span class="n">Cv_outlet</span><span class="o">=</span> <span class="mf">1E-1</span>           <span class="c1"># outlet valve constant (m/sec/bar)</span>

<span class="n">CR1</span><span class="o">.</span><span class="n">boundaryC_info</span><span class="p">(</span><span class="n">P_outlet</span><span class="p">,</span> <span class="n">P_inlet</span><span class="p">,</span> <span class="n">T_feed</span><span class="p">,</span> <span class="n">y_feed</span><span class="p">,</span>
                  <span class="n">Cv_inlet</span><span class="p">,</span> <span class="n">Cv_outlet</span><span class="p">,</span>
                  <span class="n">foward_flow_direction</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">y_res</span> <span class="o">=</span> <span class="n">CR1</span><span class="o">.</span><span class="n">run_mamoen</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="n">n_sec</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">CPUtime_print</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### Purge step ###</span>
<span class="n">CR1</span><span class="o">.</span><span class="n">next_init</span><span class="p">()</span>

<span class="c1">### Operating conditions</span>
<span class="n">P_inlet</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">P_outlet</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">T_feed</span> <span class="o">=</span> <span class="mi">323</span>
<span class="n">y_feed</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.999</span><span class="p">]</span>

<span class="n">Cv_inlet</span> <span class="o">=</span> <span class="mf">1E-1</span>             <span class="c1"># inlet valve constant (m/sec/bar)</span>
<span class="n">Cv_outlet</span><span class="o">=</span> <span class="mf">4E-1</span>           <span class="c1"># outlet valve constant (m/sec/bar)</span>

<span class="n">CR1</span><span class="o">.</span><span class="n">boundaryC_info</span><span class="p">(</span><span class="n">P_outlet</span><span class="p">,</span> <span class="n">P_inlet</span><span class="p">,</span> <span class="n">T_feed</span><span class="p">,</span> <span class="n">y_feed</span><span class="p">,</span>
                  <span class="n">Cv_inlet</span><span class="p">,</span> <span class="n">Cv_outlet</span><span class="p">,</span>
                  <span class="n">foward_flow_direction</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">y_res</span> <span class="o">=</span> <span class="n">CR1</span><span class="o">.</span><span class="n">run_mamoen</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="n">n_sec</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">CPUtime_print</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To implement the final pressurization step, an iterative method is required in order to stabilize the simulation mainly because extreme pressure changes may result in calculation errors. The simulation was performed while repeatedly calculating a time of approximately 5 s, and the results of each iteration were stored to derive the final results for the pressurization step. <strong>Using iterative calculation, the column was pressurized from 1 bar to over 9 bar.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### Pressurization step ###</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">R_gas</span> <span class="o">=</span> <span class="mf">8.3145</span>      <span class="c1"># 8.3145 J/mol/K</span>

<span class="n">total_y</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">CR4</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">CR3</span><span class="p">)</span>
<span class="n">CR4</span><span class="o">.</span><span class="n">next_init</span><span class="p">()</span>
<span class="n">P_outlet</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">P_inlet</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">while</span> <span class="n">P_outlet</span><span class="o">&lt;</span><span class="mf">9.1</span><span class="p">:</span>
   <span class="c1">### Operating conditions</span>
   <span class="n">T_feed</span> <span class="o">=</span> <span class="mi">323</span>
   <span class="n">y_feed</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">0.67</span><span class="p">]</span>

   <span class="n">Cv_inlet</span> <span class="o">=</span><span class="p">(</span><span class="n">P_inlet</span><span class="o">-</span><span class="n">P_outlet</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span>             <span class="c1"># inlet valve constant (m/sec/bar)</span>
   <span class="n">Cv_outlet</span><span class="o">=</span> <span class="mf">0E-1</span>           <span class="c1"># outlet valve constant (m/sec/bar)</span>

   <span class="n">CR4</span><span class="o">.</span><span class="n">boundaryC_info</span><span class="p">(</span><span class="n">P_outlet</span><span class="p">,</span> <span class="n">P_inlet</span><span class="p">,</span> <span class="n">T_feed</span><span class="p">,</span> <span class="n">y_feed</span><span class="p">,</span>
                  <span class="n">Cv_inlet</span><span class="p">,</span> <span class="n">Cv_outlet</span><span class="p">,</span>
                  <span class="n">foward_flow_direction</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
   <span class="n">y_res</span> <span class="o">=</span> <span class="n">CR4</span><span class="o">.</span><span class="n">run_mamoen</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">n_sec</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                                    <span class="n">CPUtime_print</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
   <span class="n">total_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_res</span><span class="p">)</span>

   <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
      <span class="n">Tg_res</span> <span class="o">=</span> <span class="n">y_res</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span> <span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="p">]</span>
      <span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">+</span> <span class="n">y_res</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,(</span><span class="n">ii</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="p">:(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="p">]</span><span class="o">*</span><span class="n">R_gas</span><span class="o">*</span><span class="n">Tg_res</span><span class="o">/</span><span class="mf">1E5</span>

   <span class="n">P_outlet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
   <span class="n">P_inlet</span> <span class="o">=</span> <span class="n">P_outlet</span><span class="o">+</span><span class="mf">1.1</span>
   <span class="c1"># fig, ax = CR4.Graph_P(1, loc=[1.15,0.9])</span>
   <span class="c1"># plt.show()</span>
   <span class="n">CR4</span><span class="o">.</span><span class="n">next_init</span><span class="p">()</span>
</pre></div>
</div>
<p>The simulation results at each step are shown in below figure.</p>
<figure class="align-center" style="width: 99%">
<img alt="Example2_results" src="_images/Example2_results.png" />
</figure>
</section>
<hr class="docutils" />
<section id="development-of-machine-learning-based-model-for-psa-process">
<h2>3. Development of machine learning-based model for PSA process<a class="headerlink" href="#development-of-machine-learning-based-model-for-psa-process" title="Permalink to this heading"></a></h2>
<p><strong>Background &amp; Goal</strong></p>
<p>In previous section, a rigorous PSA process model for the separation of CO<sub>2</sub> and CH<sub>4</sub> was developed to derive the dynamic behavior of the process. Developed high-fidelity model is time-consuming for analysis according to various operating and design conditions. To resolve this issue, this case study developed a machine learning (ML) based PSA process model to predict the CO<sub>2</sub> mole fraction of raffinate stream over time (t) and then estimate the breakthrough curve at each condition. This example consists of three steps: Dataset generation, model development, and application, as shown in figure below.</p>
<figure class="align-center" style="width: 100%">
<img alt="Example3" src="_images/example3.png" />
</figure>
<p>Before initiating this process, <strong>pyAPEP packages and other open-source Python packages were imported for data treatment and visualization.</strong> To develop a machine learning model for PSA process, scikit learn, and other analysis packages and modules are necessary. Additionally, the users are required to download an adsorption data file (Casestudy2_Zeolite13X.csv and Casestudy3_simsep_res.csv).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pyAPEP package import</span>
<span class="kn">import</span> <span class="nn">pyapep.isofit</span> <span class="k">as</span> <span class="nn">isofit</span>
<span class="kn">import</span> <span class="nn">pyapep.simsep</span> <span class="k">as</span> <span class="nn">simsep</span>

<span class="c1"># Data treatment package import</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Data visualization package import</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># ML model development and evaluation module import</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="c1"># Results anaysis module import</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
</pre></div>
</div>
<p>As in case study 2, <strong>isotherm is derived from :math:`CO_2` and :math:`CH_4` pressure-adsorption data using</strong> <code class="xref py py-mod docutils literal notranslate"><span class="pre">isofit</span></code> <strong>modules.</strong> Then, for simplification, mixture isotherm is defined under the assumption that each component behaves independently.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data import, isotherm define</span>
<span class="n">Data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Casestudy2_Zeolite13X.csv&#39;</span><span class="p">)</span>

<span class="n">P_CO2</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Pressure_CO2 (bar)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">q_CO2</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Uptake_CO2 (mol/kg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

<span class="n">P_CH4</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Pressure_CH4 (bar)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">q_CH4</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Uptake_CH4 (mol/kg)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

<span class="n">CO2_iso</span><span class="p">,</span> <span class="n">CO2_p</span><span class="p">,</span> <span class="n">CO2_name</span><span class="p">,</span> <span class="n">CO2_err</span> <span class="o">=</span> <span class="n">isofit</span><span class="o">.</span><span class="n">best_isomodel</span><span class="p">(</span><span class="n">P_CO2</span><span class="p">,</span> <span class="n">q_CO2</span><span class="p">)</span>
<span class="n">CH4_iso</span><span class="p">,</span> <span class="n">CH4_p</span><span class="p">,</span> <span class="n">CO2_p</span><span class="p">,</span> <span class="n">CH4_err</span> <span class="o">=</span> <span class="n">isofit</span><span class="o">.</span><span class="n">best_isomodel</span><span class="p">(</span><span class="n">P_CH4</span><span class="p">,</span> <span class="n">q_CH4</span><span class="p">)</span>
<span class="n">CO2_iso_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">P</span><span class="p">,</span><span class="n">T</span><span class="p">:</span> <span class="n">CO2_iso</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">CH4_iso_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">P</span><span class="p">,</span><span class="n">T</span><span class="p">:</span> <span class="n">CH4_iso</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">MixIso</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
   <span class="n">q1</span> <span class="o">=</span> <span class="n">CO2_iso</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">q2</span> <span class="o">=</span> <span class="n">CH4_iso</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
   <span class="k">return</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span>
</pre></div>
</div>
<p>Then, <strong>import simulation results and split the data into train and test dataset.</strong> The dataset was obtained by the dynamic simulation using <code class="xref py py-mod docutils literal notranslate"><span class="pre">simsep</span></code>. A thousand repetitive calculations were performed by changing the length(L), radidus(R), and operating pressure (<span class="math notranslate nohighlight">\(P_{high}\)</span>) of the packing column, which affect the breakthrough time a lot. Each input variable was randomly set under domain range <span class="math notranslate nohighlight">\(1 \le L \le 10\)</span> (m), <span class="math notranslate nohighlight">\(0.1 \le R \le 0.5\)</span> (m) and <span class="math notranslate nohighlight">\(5 \le P_{high} \le 20\)</span> (bar). Output variables were set composition of raffinate stream at time t (100, 200, …, 1900 s).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random data import</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Casestudy3_simsep_res.csv&#39;</span><span class="p">)</span>

<span class="c1"># Train-test split</span>
<span class="n">x_var</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;P_high&#39;</span><span class="p">]</span>
<span class="n">y_var</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;t</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>

<span class="n">data_x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">x_var</span><span class="p">]</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">y_var</span><span class="p">]</span>

<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">102</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Using a machine learning library, scikit learn, PSA process model for the prediction of raffinate gas composition is developed using random forest regression algorithm.</strong> Because this example shows how to integrate <code class="xref py py-mod docutils literal notranslate"><span class="pre">pyAPEP</span></code> with other Python packages, complex methods such as optimization of model structure and deep learning are not implemented. Based on compatibility with other packages shown in this example, users can apply the proposed package to various fields.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random forest regression model development and evaluation</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_var</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_var</span><span class="p">)):</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_var</span><span class="p">),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">pred</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
   <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">pred</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Predict&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R2: &#39;</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" style="width: 95%">
<img alt="ex3_res1" src="_images/ex3_res1.png" />
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model analysis in various conditions</span>
<span class="n">L_dom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">P_dom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">LP_dom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">L_dom</span><span class="p">,</span> <span class="n">P_dom</span><span class="p">)))</span>
<span class="n">x_dom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">LP_dom</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.25</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_dom</span><span class="p">)</span>
<span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">y_pred</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="mi">100</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">y_var</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_var</span><span class="p">),</span><span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_var</span><span class="p">)):</span>
   <span class="n">y_dom</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_pred</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
   <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">P_dom</span><span class="p">,</span> <span class="n">L_dom</span><span class="p">,</span> <span class="n">y_dom</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span> <span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
   <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pressure (bar)&#39;</span><span class="p">)</span>
   <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Length (m)&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Molefraction (t=</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-center" style="width: 95%">
<img alt="ex3_res2" src="_images/ex3_res2.png" />
</figure>
<p><strong>Using the developed machine learning model, the composition of the raffinate flow is predicted every 100 seconds, and a breakthrough curve is derived from the results.</strong> In the graph, the point is the composition predicted by the machine learning model, and the line is a function derived by interpolating each point.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># breakthrough curve prediction</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)):</span>
   <span class="n">pred_tmp</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
   <span class="n">bt_crv</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">pred_tmp</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;cubic&#39;</span> <span class="p">)</span>

   <span class="n">t_dom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1900</span><span class="p">)</span>
   <span class="n">fn_pred</span> <span class="o">=</span> <span class="n">bt_crv</span><span class="p">(</span><span class="n">t_dom</span><span class="p">)</span>

   <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_dom</span><span class="p">,</span> <span class="n">fn_pred</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_dom</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">fn_pred</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">y_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span>
                  <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">1</span><span class="o">-</span><span class="n">y_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span>
                  <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;mole fraction (mol/mol)&#39;</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-center" style="width: 90%">
<img alt="ex3_res3" src="_images/ex3_res3.png" />
</figure>
<hr class="docutils" />
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="simsep.html" class="btn btn-neutral float-left" title="Real PSA simulation module (pyAPEP.simsep)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="FAQs.html" class="btn btn-neutral float-right" title="FAQs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, anna.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>